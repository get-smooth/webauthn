<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title></title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="book.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="index.html">Home</a></li><li class="chapter-item affix "><li class="part-title">src</li><li class="chapter-item "><a href="src/WebAuthn256r1.sol/contract.WebAuthn256r1.html">WebAuthn256r1</a></li><li class="chapter-item "><a href="src/WebAuthnBase.sol/abstract.WebAuthnBase.html">WebAuthnBase</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/0x90d2b2b7fb7599eebb6e7a32980857d8/webauthn" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="webauthn-library"><a class="header" href="#webauthn-library">WebAuthn Library</a></h1>
<p><a href="https://github.dev/0x90d2b2b7fb7599eebb6e7a32980857d8/webauthn/tree/main"><img src="https://img.shields.io/badge/Github-Open%20the%20Editor-purple?logo=github" alt="Open in Github" /></a> <a href="https://github.com/0x90d2b2b7fb7599eebb6e7a32980857d8/webauthn/actions/workflows/quality-checks.yml"><img src="https://github.com/0x90d2b2b7fb7599eebb6e7a32980857d8/webauthn/actions/workflows/quality-checks.yml/badge.svg?branch=main" alt="Github Actions" /></a>
<a href="https://github.com/0x90d2b2b7fb7599eebb6e7a32980857d8/webauthn/actions/workflows/tests.yml"><img src="https://github.com/0x90d2b2b7fb7599eebb6e7a32980857d8/webauthn/actions/workflows/tests.yml/badge.svg?branch=main" alt="Github Actions" /></a>
<a href="https://github.com/0x90d2b2b7fb7599eebb6e7a32980857d8/webauthn/actions/workflows/static-analysis.yml"><img src="https://github.com/0x90d2b2b7fb7599eebb6e7a32980857d8/template-foundry/actions/workflows/static-analysis.yml/badge.svg?branch=main" alt="Github Actions" /></a>
<a href="https://github.com/0x90d2b2b7fb7599eebb6e7a32980857d8/webauthn/actions/workflows/release-package.yml"><img src="https://github.com/0x90d2b2b7fb7599eebb6e7a32980857d8/webauthn/actions/workflows/release-package.yml/badge.svg" alt="Github Actions" /></a> <a href="https://book.getfoundry.sh/"><img src="https://img.shields.io/badge/Built%20with-Foundry-FFDB1C.svg" alt="Foundry" /></a>
<a href="./LICENSE.html"><img src="https://img.shields.io/badge/License-APACHE2-pink.svg" alt="License: MIT" /></a> <img src="https://img.shields.io/badge/Audited-No-red.svg" alt="Is it audited?" /></p>
<h2 id="description"><a class="header" href="#description">Description</a></h2>
<p><code>webauthn</code> is a library designed for signature validation through the Web Authentication process. Currently, it supports only the ECDSA signature scheme utilizing the secp256r1 curve. This functionality is provided by the <a href="https://github.com/0x90d2b2b7fb7599eebb6e7a32980857d8/secp256r1-verify">secp256r1 library</a>. Support for additional algorithms is planned for future releases.</p>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<h3 id="foundry"><a class="header" href="#foundry">Foundry</a></h3>
<p>To install the <code>webauthn</code> package in a Foundry project, execute the following command:</p>
<pre><code class="language-sh">forge install https://github.com/0x90d2b2b7fb7599eebb6e7a32980857d8/webauthn
</code></pre>
<p>This command will install the latest version of the package in your lib directory. To install a specific version of the
library, follow the instructions in the
<a href="https://book.getfoundry.sh/reference/forge/forge-install?highlight=forge%20install#forge-install">official Foundry documentation</a>.</p>
<h3 id="hardhat-or-truffle"><a class="header" href="#hardhat-or-truffle">Hardhat or Truffle</a></h3>
<p>To install the <code>webauthn</code> package in a Hardhat or Truffle project, use <code>npm</code> to run the following command:</p>
<pre><code class="language-sh">npm install @0x90d2b2b7fb7599eebb6e7a32980857d8/webauthn
</code></pre>
<p>After the installation, import the package into your project and use it to validate a Web Authentication signature.</p>
<blockquote>
<p>‚ö†Ô∏è Note: This package is not published on the npm registry, and is only available on GitHub Packages. You need to be
authenticated with GitHub Packages to install it. For more information, please refer to the
<a href="index.html#setup-github-registry">troubleshooting section</a>. We are willing to deploy it on the npm registry if there is a need.
Please open an issue if you would like to see this package on the npm registry.</p>
</blockquote>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>This repository supports the verification of Web Authentication signatures using the ECDSA signature scheme with the secp256r1 curve. The non-experimental implementations from the <a href="https://github.com/0x90d2b2b7fb7599eebb6e7a32980857d8/secp256r1-verify">secp256r1 library</a> are all supported. After you've integrated this library into your project, you can freely import and use the implementation that best suits your specific use cases and requirements. Let's take a more detailed look at each one.</p>
<blockquote>
<p>üö® None of the implementations have been audited. DO NOT USE THEM IN PRODUCTION.</p>
</blockquote>
<h3 id="scripts"><a class="header" href="#scripts">Scripts</a></h3>
<p>This repository includes a <a href="./script">script</a> directory containing a set of scripts that can be used to deploy the
different implementations on-chain. Each script contains a set of instructions and an example of how to use it. The
scripts are expected to be run using the <code>forge script</code> command.</p>
<h2 id="gas-reports"><a class="header" href="#gas-reports">Gas reports</a></h2>
<p>These gas reports were produced using the <code>0.8.19</code> version of the Solidity compiler (with 100k optimizer runs), specifically for the <a href="https://github.com/0x90d2b2b7fb7599eebb6e7a32980857d8/webauthn/releases/tag/v0.1.0"><code>0.1.0</code></a> version of the library.</p>
<div class="table-wrapper"><table><thead><tr><th>test/WebAuthnBase.t.sol:WebAuthnImplementation contract</th><th>Deployment Cost</th><th>Deployment Size</th><th>min</th><th>avg</th><th>median</th><th>max</th><th># calls</th></tr></thead><tbody>
<tr><td>Deployment Cost</td><td>292131</td><td>1491</td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td>Function Name</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td>_generateMessage</td><td></td><td></td><td>5194</td><td>5225</td><td>5194</td><td>5385</td><td>6</td></tr>
</tbody></table>
</div>
<p>This runtime cost corresponds to the real cost added by the WebAuthn signature verification process</p>
<div class="table-wrapper"><table><thead><tr><th>src/WebAuthn256r1.sol:WebAuthn256r1 contract</th><th>Deployment Cost</th><th>Deployment Size</th><th>min</th><th>avg</th><th>median</th><th>max</th><th># calls</th></tr></thead><tbody>
<tr><td>Deployment Cost</td><td>1889590</td><td>9470</td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td>Function Name</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td>verify(bytes1,bytes,bytes,bytes,uint256,uint256,uint256,address)(bool)</td><td></td><td></td><td>80456</td><td>80456</td><td>80456</td><td>80456</td><td>1</td></tr>
<tr><td>verify(bytes1,bytes,bytes,bytes,uint256,uint256,uint256,uint256,uint256)(bool)</td><td></td><td></td><td>209146</td><td>209146</td><td>209146</td><td>209146</td><td>1</td></tr>
</tbody></table>
</div>
<p>These costs can be considered end-to-end as it includes the cost of the different implementation in the <a href="https://github.com/0x90d2b2b7fb7599eebb6e7a32980857d8/secp256r1-verify">secp256r1 library</a></p>
<blockquote>
<p>‚ÑπÔ∏è Tests expected to revert are excluded from the gas report</p>
</blockquote>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p>To contribute to the project, you must have Foundry and Node.js installed on your system. You can download them from
their official websites:</p>
<ul>
<li>Node.js: https://nodejs.org/</li>
<li>Foundry: https://book.getfoundry.sh/getting-started/installation</li>
</ul>
<blockquote>
<p>‚ÑπÔ∏è We recommend using <a href="https://github.com/nvm-sh/nvm">nvm</a> to manage your Node.js versions. Nvm is a flexible node
version manager that allows you to switch between different versions of Node.js effortlessly. This repository includes
a <code>.nvmrc</code> file at the root of the project. If you have nvm installed, you can run <code>nvm use</code> at the root of the
project to automatically switch to the appropriate version of Node.js.</p>
</blockquote>
<p>Following the installation of Foundry and Node.js, there's an additional dependency called <code>make</code> that needs to be
addressed.</p>
<p><code>make</code> is a build automation tool that employs a file known as a makefile to automate the construction of executable
programs and libraries. The makefile details the process of deriving the target program from the source files and other
dependencies. This allows developers to automate repetitive tasks and manage complex build processes efficiently. <code>make</code>
is our primary tool in a multi-environment repository. It enables us to centralize all commands into a single file
(<a href="./makefile">the makefile</a>), eliminating the need to deal with <code>npm</code> scripts defined in a package.json or remembering
the various commands provided by the <code>foundry</code> cli. If you're unfamiliar with <code>make</code>, you can read more about it
<a href="https://www.gnu.org/software/make/manual/make.html">here</a>.</p>
<p><code>make</code> is automatically included in all modern Linux distributions. If you're using Linux, you should be able to use
<code>make</code> without any additional steps. If not, you can likely find it in the package tool you usually use. MacOS users can
install <code>make</code> using <a href="https://formulae.brew.sh/formula/make">Homebrew</a> with the following command:</p>
<pre><code class="language-sh">brew install make
</code></pre>
<p>At this point, you should have all the required dependencies installed on your system.</p>
<blockquote>
<p>üí° Running make at the root of the project will display a list of all the available commands. This can be useful to
know what you can do</p>
</blockquote>
<h3 id="installing-the-dependencies"><a class="header" href="#installing-the-dependencies">Installing the dependencies</a></h3>
<p>To install the project dependencies, you can run the following command:</p>
<pre><code class="language-sh">make install
</code></pre>
<p>This command will install the forge dependencies in the <code>lib/</code> directory, the npm dependencies in the <code>node_modules</code>
directory and the git hooks defined in the project (<a href="index.html#git-hooks">refer to the Git hooks section</a>s to learn more about
them). These dependencies aren't shipped in production; they're utility dependencies used to build, test, lint, format,
and more, for the project.</p>
<blockquote>
<p>‚ö†Ô∏è This package uses a dependency installed on the Github package registry, meaning you need to authenticate with
GitHub Packages to install it. For more information, refer to the <a href="index.html#setup-github-registry">troubleshooting section</a>.
We're open to deploying it on the npm registry if there's a demand for it. Please open an issue if you'd like to see
this package on the npm registry.</p>
</blockquote>
<p>Next, let's set up the git hooks.</p>
<h3 id="git-hooks"><a class="header" href="#git-hooks">Git hooks</a></h3>
<p>This project uses <code>Lefthook</code> to manage Git hooks, which are scripts that run automatically when certain Git events
occur, such as committing code or pushing changes to a remote repository. <code>Lefthook</code> simplifies the management and
execution of these scripts.</p>
<p>After installing the dependencies, you can configure the Git hooks by running the following command in the project
directory:</p>
<pre><code class="language-sh">make hooks-i
</code></pre>
<p>This command installs a Git hook that runs Lefthook before pushing code to a remote repository. If Lefthook fails, the
push is aborted.</p>
<p>If you wish to run Lefthook manually, you can use the following command:</p>
<pre><code class="language-sh">make hooks
</code></pre>
<p>This will run all the Git hooks defined in the <a href="./lefthook.yml">lefthook</a> file.</p>
<h4 id="skipping-git-hooks"><a class="header" href="#skipping-git-hooks">Skipping git hooks</a></h4>
<p>Should you need to intentionally skip Lefthook, you can pass the <code>--no-verify</code> flag to the git push command. To bypass
Lefthook when pushing code, use the following command:</p>
<pre><code class="language-sh">git push origin --no-verify
</code></pre>
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<h3 id="unit-tests"><a class="header" href="#unit-tests">Unit tests</a></h3>
<p>The unit tests are stored in the <code>test</code> directory. They test individual functions of the package in isolation. These
tests are automatically run by GitHub Actions with every push to the <code>main</code> branch and on every pull request targeting
this branch. They are also automatically run by the git hook on every push to a remote repository if you have installed
it (<a href="index.html#git-hooks">refer to the Git hooks section</a>). Alternatively, you can run them locally by executing the following
command in the project directory:</p>
<pre><code class="language-sh">make test
</code></pre>
<blockquote>
<p>‚ÑπÔ∏è By adding the sufix <code>-v</code> the test command will run in verbose mode, displaying valuable output for debugging.</p>
</blockquote>
<p>For your information, these tests are written using <a href="https://book.getfoundry.sh/forge/tests">forge</a>, and some employ the
property-based testing pattern <em>(fuzzing)</em> to generate random inputs for the functions under test.</p>
<p>The tests use one cheat code` you should be aware of:</p>
<ul>
<li><code>vm.ffi</code>: This cheat code allows us to execute an arbitrary command during the test suite. This cheat code is not
enabled by default when creating a new foundry project, but in our case, it's enabled in our configuration
(<a href="./foundry.toml">foundry configuration</a>) for all tests. This cheat code is used to run the computation library that
calculates 256 points on the secp256r1 elliptic curve from a public key. This is required for the variants that need
these points to be deployed on-chain. Therefore, even if it's not explicit, every time you run the test suite, a
Node.js script is executed at least one time. You can learn more about the library we use
<a href="https://github.com/0x90d2b2b7fb7599eebb6e7a32980857d8/secp256r1-computation">here</a>.</li>
</ul>
<blockquote>
<p>üìñ Cheatcodes are special instructions exposed by Foundry to enhance the developer experience. Learn more about them
<a href="https://book.getfoundry.sh/cheatcodes/">here</a>.</p>
</blockquote>
<blockquote>
<p>üí° Run <code>make</code> to learn how to run the test in verbose mode, or display the coverage, or even generate a gas report.</p>
</blockquote>
<h3 id="quality"><a class="header" href="#quality">Quality</a></h3>
<p>This repository uses <code>forge-fmt</code>, <code>solhint</code>, and <code>prettier</code> to enforce code quality. These tools are automatically run by
the GitHub Actions on every push to the <code>main</code> branch and on every pull request targeting this branch. They are also
automatically run by the git hook on every push to a remote repository if you have installed it
(<a href="index.html#git-hooks">refer to the Git hooks section</a>). Alternatively, you can run them locally by executing the following
command in the project directory:</p>
<pre><code class="language-sh">make lint # run the linter
make format # run the formatter
make quality # run both
</code></pre>
<blockquote>
<p>‚ÑπÔ∏è By adding the suffix <code>-fix</code> the linter and the formatter will try to fix the issues automatically.</p>
</blockquote>
<h2 id="troubleshootings"><a class="header" href="#troubleshootings">Troubleshootings</a></h2>
<h3 id="setup-github-registry"><a class="header" href="#setup-github-registry">Setup Github registry</a></h3>
<p>You need to configure npm to use the Github registry. You can do so using the following command in your terminal:</p>
<pre><code class="language-sh">npm config set @0x90d2b2b7fb7599eebb6e7a32980857d8:registry=https://npm.pkg.github.com
</code></pre>
<p>This will instruct npm to use the Github registry for packages deployed by <code>@0x90d2b2b7fb7599eebb6e7a32980857d8</code>.</p>
<p>Once the Github registry is configured, you have to create a <strong>classic</strong> token on Github. To do so, go to your
<a href="https://github.com/settings/tokens">Github settings</a>. The token must have the read:packages scope. Once you have
created the token, use the following command in your terminal to authenticate to the Github registry:</p>
<pre><code class="language-sh">npm login --auth-type=legacy --registry=https://npm.pkg.github.com
</code></pre>
<p>Your Github username is the username, and the password is the token you just created. At this point, your git should be
configured to use the Github Package Registry for our packages.</p>
<blockquote>
<p>‚ö†Ô∏è For more information, please refer to the
<a href="https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-npm-registry#installing-a-package">GitHub documentation</a></p>
</blockquote>
<h2 id="acknowledgements"><a class="header" href="#acknowledgements">Acknowledgements</a></h2>
<p>Special thanks to <a href="https://github.com/btchip">btchip</a> for developing the reference implementation
<a href="https://github.com/btchip/Webauthn.sol">here</a> and for the invaluable guidance through the WebAuthn specification.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="webauthn256r1"><a class="header" href="#webauthn256r1">WebAuthn256r1</a></h1>
<p><a href="https://github.com/0x90d2b2b7fb7599eebb6e7a32980857d8/webauthn/blob/30fb3f93b8284e69b023293356403f38c43eafe6/src/WebAuthn256r1.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/WebAuthn256r1.sol//src/WebAuthnBase.sol/abstract.WebAuthnBase.html">WebAuthnBase</a></p>
<p>A library to verify ECDSA signature though WebAuthn on the secp256r1 curve</p>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="verify"><a class="header" href="#verify">verify</a></h3>
<p>Verify ECDSA signature though WebAuthn on the secp256r1 curve</p>
<pre><code class="language-solidity">function verify(
    bytes1 authenticatorDataFlagMask,
    bytes calldata authenticatorData,
    bytes calldata clientData,
    bytes calldata clientChallenge,
    uint256 clientChallengeOffset,
    uint256 r,
    uint256 s,
    uint256 qx,
    uint256 qy
)
    external
    returns (bool);
</code></pre>
<h3 id="verify-1"><a class="header" href="#verify-1">verify</a></h3>
<p>Verify ECDSA signature though WebAuthn on the secp256r1 curve using a precomputed table</p>
<pre><code class="language-solidity">function verify(
    bytes1 authenticatorDataFlagMask,
    bytes calldata authenticatorData,
    bytes calldata clientData,
    bytes calldata clientChallenge,
    uint256 clientChallengeOffset,
    uint256 r,
    uint256 s,
    address precomputedTable
)
    external
    returns (bool);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="webauthnbase"><a class="header" href="#webauthnbase">WebAuthnBase</a></h1>
<p><a href="https://github.com/0x90d2b2b7fb7599eebb6e7a32980857d8/webauthn/blob/30fb3f93b8284e69b023293356403f38c43eafe6/src/WebAuthnBase.sol">Git Source</a></p>
<p>An abstract contract that validates the WebAuthn data and generates the message to recover</p>
<h2 id="functions-1"><a class="header" href="#functions-1">Functions</a></h2>
<h3 id="generatemessage"><a class="header" href="#generatemessage">generateMessage</a></h3>
<p>Validate the webauthn data and generate the signature message needed to recover</p>
<p><em>1. The signature counter is not checked in this implementation because
we already have the nonce on-chain to prevent the anti-replay attack.
The counter is 4-bytes long and it is located at bytes 33 of the authenticator data.
2. The RP.ID is not checked in this implementation as it is impossible to generate
the same keys for different RP.IDs with a well formed authenticator. The hash of the id
is 32-bytes long and it is located at bytes 0 of the authenticator data.
3. The length of the authenticator data is not fixed. It is at least 37 bytes
(rpIdHash (32) + flags (1) + counter (4)) but it can be longer if there is an
attested credential data and/or some extensions data. As we do not consider
the counter in this implementation, we only require the authenticator data to be
at least 32 bytes long in order to save some calldata gas.
4. You may probably ask why we encode the challenge in base64 on-chain instead of
of sending it already encoded to save some gas. This library is opinionated and
it assumes that it is used in the context of Account Abstraction. In this context,
valuable informations required to proceed the transaction will be stored in the
challenge meaning we need the challenge in clear to use it later in the flow.
That's why we decided to add an extra encoding step during the validation.
5. It is assumed this is not the responsibility of this contract to check the value
of the <code>alg</code> parameter. It is expected this contract will be extended by another
contract that will redirect the message produced by this contract to the right
recovery function.
6. Both extension data and attested credential data are out of scope of this implementation.
7. It is not the responsibility of this contract to validate the attestation statement formats
This contract is based on the level 2 of the WebAuthn specification.
and until proven otherwise compliant with the level 3 of the specification.</em></p>
<pre><code class="language-solidity">function generateMessage(
    bytes1 authenticatorDataFlagMask,
    bytes calldata authenticatorData,
    bytes calldata clientData,
    bytes calldata clientChallenge,
    uint256 clientChallengeOffset
)
    internal
    pure
    returns (bytes32 message);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>authenticatorDataFlagMask</code></td><td><code>bytes1</code></td><td>This is a bit mask that will be used to validate the flag in the authenticator data. The flag is located at byte 32 of the authenticator data and is used to indicate, among other things, wheter the user's presence/verification ceremonies have been performed. This argument is not expected to be exposed to the end user, it is the responsibility of the caller to enforce the value of the flag for their flows. Here are some flags you may want to use depending on your needs. - 0x01: User presence (UP) is required. If the UP flag is not set, revert - 0x04: User verification (UV) is required. If the UV flag is not set, revert - 0x05: UV and UP are both accepted. If none of them is set, revert</td></tr>
<tr><td><code>authenticatorData</code></td><td><code>bytes</code></td><td>The authenticator data structure encodes contextual bindings made by the authenticator. Described here: https://www.w3.org/TR/webauthn-2/#authenticator-data</td></tr>
<tr><td><code>clientData</code></td><td><code>bytes</code></td><td>This is the client data that was signed. The client data represents the contextual bindings of both the WebAuthn Relying Party and the client. Described here: https://www.w3.org/TR/webauthn-2/#client-data</td></tr>
<tr><td><code>clientChallenge</code></td><td><code>bytes</code></td><td>This is the challenge that was sent to the client to sign. It is part of the client data. In a classic non-EVM flow, this challenge is generated by the server and sent to the client to avoid replay attack. In our context, as we already have the nonce for this purpose we use this field to pass the arbitrary execution order. This value is expected to not be encoded in Base64, the encoding is done during the verification.</td></tr>
<tr><td><code>clientChallengeOffset</code></td><td><code>uint256</code></td><td>The offset of the client challenge in the client data</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>message</code></td><td><code>bytes32</code></td><td>The signature message needed to recover</td></tr>
</tbody></table>
</div>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="invalidauthenticatordata"><a class="header" href="#invalidauthenticatordata">InvalidAuthenticatorData</a></h3>
<pre><code class="language-solidity">error InvalidAuthenticatorData();
</code></pre>
<h3 id="invalidclientdata"><a class="header" href="#invalidclientdata">InvalidClientData</a></h3>
<pre><code class="language-solidity">error InvalidClientData();
</code></pre>
<h3 id="invalidchallenge"><a class="header" href="#invalidchallenge">InvalidChallenge</a></h3>
<pre><code class="language-solidity">error InvalidChallenge();
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="solidity.min.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
